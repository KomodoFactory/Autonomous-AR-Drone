<!DOCTYPE html>
<html>
<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>

    <style type="text/css" media="screen">
        body {
            margin: 0;
            padding: 0;
            height: 100%;
            background: #DDDDDD;
            color: #fff;
            font-family: Helvetica, Arial, "MS Trebuchet", sans-serif;
        }
        #pngStream {
            width: 100%;
            height: 400px;
            float: left;
        }
        #pngStreamCanvas {
            width: 100%;
            height: 400px;
        }
        #data, #controls {
            width: 50%;
            float: left;
        }
        .section {
            width: 33%;
            float: left;
        }

        .section button {
            padding: 5px;
            background: #fff;
            border: none;
            min-width: 100px;
            cursor: pointer;
        }
        .section button:active {
            background: #7FF2F6;
        }

    </style>
</head>

<body>
<div id='pngStream'>
    <canvas id="pngStreamCanvas"></canvas>
</div>

<div id='controls'>
    <div class='section'>
        <button id='takeoff'>Takeoff</button>
        <br/>
        <button id='land'>Land</button>
        <br/>
        <button id='reset'>Reset</button>
    </div>
    <div class='section'>
        <button id='search'>Start Search</button>
        <br/>
        <button id='track'>Track Picture</button>
        <br/>
        <button id='save'>Save Picture</button>
    </div>


</div>
<div id='data'>
    <div id="drone-position">
       <br/>Battery:
        <span class='battery'>0</span>%
    </div>
</div>

<script src="jquery.js"></script>
<script src="/socket.io/socket.io.js"></script>
<script src="tracking/build/tracking-min.js"></script>


<script>
    var socket = io.connect('/');
    var lat, lon, drone;


    //might be usefull to keep
    function setCurrentTarget(lat, lon) {
        targetLat = lat
        targetLon = lon
        socket.emit('go', {lat: targetLat, lon: targetLon})
    }

    function clearCurrentTarget() {
        targetLat = undefined
        targetLon = undefined
        socket.emit('stop')
    }

    $(function () {
        $('#takeoff').click(function () {
            socket.emit('takeoff')
        })
        $('#land').click(function () {
            socket.emit('land')
        })
        $('#reset').click(function () {
            socket.emit('reset')
        })
        $('#save').click(function(){
            socket.emit('FuckMe')
        })

    })

    socket.on('connect', function () {
        socket.on('waypointReached', function (data) {
           socket.emit('Waypoint?')
        })

        socket.on('drone', function (data) {
            if (data.battery != undefined) {
                $('#drone-position .battery').text(data.battery)
            }
        })


        /*
        socket.on('FuckMe', function () {
            window.addEventListener("load", draw, false);

            function draw()
            {
                console.log('blabla', (document.getElementById("droneStream")));
                console.log('child', document.getElementById("droneStream").childNodes);
                console.log('canvas', document.getElementById("droneStream").childNodes[0]);
                var canvas = document.getElementById("droneStream").childNodes[0];
                if (canvas != null) {


                    //var canvas = document.getElementById("mycanvas");
                    var img = canvas.toDataURL("image/png");
                    console.log(canvas)
                    console.log(img)

                    document.body.appendChild(canvas);

                    img = img.replace(/^data:image\/(png|jpg);base64,/, "")

                    canvas.save
                    /*

                     var frameCounter = 0;
                     var fs = require('fs');

                     frameCounter++;
                     console.log('Saving frame');
                     fs.writeFile('testdata/frame' + frameCounter + '.png', img, function (err) {
                     if (err) {
                     console.log('Error saving PNG: ' + err);
                     }
                     });
                }
            }

        }) */
    })


    /*
     var dronetreamCanvas = $('#droneStreamCanvas');
     var context = droneStreamCanvas.getContext('2d');

     socket.on('png', function () {
     var image = new Image();
     image.src = 'testdata/frame.png';
     context.clearRect(0,0, droneStreamCanvas.width, droneStreamCanvas.height)
     context.drawImage(image, 0, 0, droneStreamCanvas.width, droneStreamCanvas.height)
     })
     })

     var tracker = new tracking.ColorTracker(['yellow']);
     tracker.setMinDimension(5);

     tracking.track($('#droneStreamCanvas'), tracker);

     tracker.on('track', function(event) {
     socket.emit('da');
     });

     initGUIControllers(tracker);
     */

</script>
</body>
</html>
